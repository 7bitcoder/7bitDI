name: Run CMake
description: "Runs CMake Build"
inputs:
  args:
    description: "Other arguments"
    required: false
    default:  -D_7BIT_DI_BUILD_TESTS:BOOL=true -D_7BIT_DI_BUILD_EXAMPLES:BOOL=true
  library-type:
    description: "Library type"
    required: false
    default: Static

runs:
  using: composite
  steps:
    - name: Set Proper Conan Profile
      uses: kanga333/variable-mapper@v0.3.0
      with:
        key: "${{ runner.os }}"
        map: |
          {
            "Windows":{
                "initPreset": "conan-default"
            },
            ".*":{
                "initPreset": "conan-release"
            }
          }

    - name: Configure CMake
      run: cmake --preset ${{ env.initPreset }} -D_7BIT_DI_LIBRARY_TYPE=${{ inputs.library-type }} ${{ inputs.args }}
      shell: pwsh

    - name: Build
      run: cmake --build --preset conan-release
      shell: pwsh
